<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title or "–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∫–∏–¥–æ–∫" }}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/web">
                <i class="fas fa-book-open"></i> BookHunter
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/web">
                            <i class="fas fa-home"></i> –ì–ª–∞–≤–Ω–∞—è
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/web/books">
                            <i class="fas fa-book"></i> –ö–∞—Ç–∞–ª–æ–≥
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/web/alerts">
                            <i class="fas fa-bell"></i> –ü–æ–¥–ø–∏—Å–∫–∏
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/admin" title="–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å">
                            <i class="fas fa-cog"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mt-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="mt-5 py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5 class="mb-2">
                        <i class="fas fa-book-open" style="color: var(--accent-primary);"></i> BookHunter
                    </h5>
                    <p class="text-muted mb-0">–í–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø–æ–∏—Å–∫–µ –ª—É—á—à–∏—Ö –∫–Ω–∏–≥ –ø–æ –ª—É—á—à–∏–º —Ü–µ–Ω–∞–º</p>
                </div>
                
                <div class="col-md-6 text-md-end">
                    <p class="text-muted mb-1">
                        <i class="fas fa-heart"></i> –°–æ–∑–¥–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –∫ –∫–Ω–∏–≥–∞–º
                    </p>
                    <p class="text-muted mb-0">
                        <small>–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã ¬© 2026</small>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω –≤ inline —Å–∫—Ä–∏–ø—Ç –Ω–∏–∂–µ -->
    
    <!-- –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ -->
    <script>
        console.log('=== DEBUG: Base.html –∑–∞–≥—Ä—É–∂–µ–Ω —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ ===');
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
        if (typeof window.parseLatest !== 'undefined') {
            console.log('DEBUG: –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é —Ñ—É–Ω–∫—Ü–∏—é parseLatest');
            delete window.parseLatest;
        }
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ parseBooks
        console.log('DEBUG: –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é parseBooks');
        
        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è parseBooks
        window.parseBooks = async function() {
            console.log('DEBUG: parseBooks –≤—ã–∑–≤–∞–Ω–∞');
            
            const parseBtn = document.getElementById('parseBtn');
            const parseStatus = document.getElementById('parseStatus');
            
            if (!parseBtn || !parseStatus) {
                console.error('DEBUG: –≠–ª–µ–º–µ–Ω—Ç—ã parseBtn –∏–ª–∏ parseStatus –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                alert('–û—à–∏–±–∫–∞: —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
            const query = "{{ query or '' }}";
            console.log('DEBUG: –ó–∞–ø—Ä–æ—Å:', query);
            
            parseBtn.disabled = true;
            parseBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–∏–Ω–≥...';
            
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∏ —Å—Ç–∞—Ç—É—Å
            parseStatus.innerHTML = `
                <div class="progress mb-2" style="height: 25px;">
                    <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-primary" 
                         role="progressbar" style="width: 25%">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</div>
                </div>
                <span class="text-info">üöÄ –ó–∞–ø—É—â–µ–Ω –ø–æ–∏—Å–∫ –Ω–æ–≤—ã—Ö –∫–Ω–∏–≥ –ø–æ –∑–∞–ø—Ä–æ—Å—É: "${query}"</span>
            `;
            
            try {
                // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–∏–Ω–≥ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ URL
                const url = `/api/parser/parse?query=${encodeURIComponent(query)}&source=chitai-gorod`;
                console.log('DEBUG: URL –∑–∞–ø—Ä–æ—Å–∞:', url);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('DEBUG: –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status, response.statusText);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('DEBUG: –†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
                    
                    const taskId = result.task_id;
                    
                    if (taskId) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                        updateProgress(50, '–ü–æ–∏—Å–∫ –∫–Ω–∏–≥ –Ω–∞ —Å–∞–π—Ç–µ...');
                        parseStatus.innerHTML = `
                            <div class="progress mb-2" style="height: 25px;">
                                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-info" 
                                     role="progressbar" style="width: 50%">–ü–æ–∏—Å–∫ –∫–Ω–∏–≥ –Ω–∞ —Å–∞–π—Ç–µ...</div>
                            </div>
                            <span class="text-info">‚úÖ –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞: ${result.message}</span>
                        `;
                        
                        // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                        trackParsingProgress(taskId, query);
                    } else {
                        throw new Error('–ù–µ –ø–æ–ª—É—á–µ–Ω ID –∑–∞–¥–∞—á–∏');
                    }
                } else {
                    // –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ
                    const errorData = await response.json();
                    const errorMessage = errorData.detail || errorData.message || `HTTP ${response.status}`;
                    console.error('DEBUG: –û—à–∏–±–∫–∞ API:', errorMessage);
                    throw new Error(errorMessage);
                }
            } catch (error) {
                console.error('DEBUG: –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:', error);
                parseStatus.innerHTML = `<div class="alert alert-danger"><strong>‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:</strong> ${error.message}</div>`;
                parseBtn.disabled = false;
                parseBtn.innerHTML = '<i class="fas fa-download"></i> –ù–∞–π—Ç–∏ –Ω–æ–≤—ã–µ –∫–Ω–∏–≥–∏';
            }
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
        window.updateProgress = function(percent, text) {
            console.log('DEBUG: –ü—Ä–æ–≥—Ä–µ—Å—Å:', percent, '% -', text);
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                progressBar.style.width = percent + '%';
                progressBar.textContent = text;
            }
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
        window.trackParsingProgress = async function(taskId, query) {
            console.log('DEBUG: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –∑–∞–¥–∞—á–∏:', taskId);
            
            const parseBtn = document.getElementById('parseBtn');
            const parseStatus = document.getElementById('parseStatus');
            
            let checkCount = 0;
            const maxChecks = 60; // –ú–∞–∫—Å–∏–º—É–º 10 –º–∏–Ω—É—Ç (60 * 10 —Å–µ–∫—É–Ω–¥)
            
            const checkStatus = async () => {
                try {
                    checkCount++;
                    console.log('DEBUG: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ #', checkCount);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏
                    if (checkCount < 5) {
                        updateProgress(60, '–ò—â–µ–º –∫–Ω–∏–≥–∏ –Ω–∞ —Å–∞–π—Ç–µ...');
                    } else if (checkCount < 15) {
                        updateProgress(75, '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã...');
                    } else if (checkCount < 25) {
                        updateProgress(85, '–°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö...');
                    } else {
                        updateProgress(95, '–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è...');
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
                    const response = await fetch(`/api/parser/parse/${taskId}`);
                    console.log('DEBUG: –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏:', response.status);
                    
                    if (response.ok) {
                        const status = await response.json();
                        console.log('DEBUG: –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏:', status);
                        
                        if (status.status === 'completed') {
                            // –ó–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
                            updateProgress(100, '–ì–æ—Ç–æ–≤–æ!');
                            parseStatus.innerHTML = `
                                <div class="alert alert-success">
                                    <h5>üéâ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!</h5>
                                    <p><strong>${status.result?.found_count || 0}</strong> –Ω–æ–≤—ã—Ö –∫–Ω–∏–≥ –Ω–∞–π–¥–µ–Ω–æ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ.</p>
                                    <p class="mb-2">–û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã...</p>
                                </div>
                            `;
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
                            parseBtn.disabled = false;
                            parseBtn.innerHTML = '<i class="fas fa-check"></i> –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω';
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                            setTimeout(() => {
                                window.location.reload();
                            }, 2000);
                            
                            return;
                            
                        } else if (status.status === 'failed') {
                            // –û—à–∏–±–∫–∞
                            parseStatus.innerHTML = `<div class="alert alert-danger"><strong>‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:</strong> ${status.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</div>`;
                            parseBtn.disabled = false;
                            parseBtn.innerHTML = '<i class="fas fa-download"></i> –ù–∞–π—Ç–∏ –Ω–æ–≤—ã–µ –∫–Ω–∏–≥–∏';
                            return;
                            
                        } else {
                            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ
                            if (checkCount < maxChecks) {
                                setTimeout(checkStatus, 10000); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
                            } else {
                                // –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è
                                parseStatus.innerHTML = `<div class="alert alert-warning"><strong>‚è∞ –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è:</strong> –ó–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –µ—â–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ —Ñ–æ–Ω–µ. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∑–∂–µ.</div>`;
                                parseBtn.disabled = false;
                                parseBtn.innerHTML = '<i class="fas fa-download"></i> –ù–∞–π—Ç–∏ –Ω–æ–≤—ã–µ –∫–Ω–∏–≥–∏';
                            }
                        }
                    } else {
                        throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞');
                    }
                    
                } catch (error) {
                    console.error('DEBUG: –û—à–∏–±–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
                    
                    if (checkCount < maxChecks) {
                        setTimeout(checkStatus, 10000); // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–ø—ã—Ç–∫–∏
                    } else {
                        parseStatus.innerHTML = `<div class="alert alert-warning"><strong>‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–≤—è–∑–∏:</strong> –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∑–∂–µ.</div>`;
                        parseBtn.disabled = false;
                        parseBtn.innerHTML = '<i class="fas fa-download"></i> –ù–∞–π—Ç–∏ –Ω–æ–≤—ã–µ –∫–Ω–∏–≥–∏';
                    }
                }
            };
            
            // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(checkStatus, 3000);
        };
        
        // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                }
            });
        }
        
        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è searchWithParsing
        window.searchWithParsing = async function() {
            console.log('DEBUG: searchWithParsing –≤—ã–∑–≤–∞–Ω–∞');
            
            const query = document.querySelector('input[name="q"]').value;
            const source = document.querySelector('select[name="source"]').value;
            
            console.log('DEBUG: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞:', {query, source});
            
            if (!query.trim()) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –ø–æ–∏—Å–∫–∞
            const searchBtn = document.querySelector('button[onclick="searchWithParsing()"]');
            const originalText = searchBtn.innerHTML;
            
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ü–æ–∏—Å–∫...';
            
            try {
                // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–∏—Å–∫ —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ URL
                const url = `/api/parser/search?query=${encodeURIComponent(query)}&source=${encodeURIComponent(source)}`;
                console.log('DEBUG: URL –∑–∞–ø—Ä–æ—Å–∞ search:', url);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('DEBUG: –û—Ç–≤–µ—Ç search API:', response.status);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('DEBUG: –†–µ–∑—É–ª—å—Ç–∞—Ç search:', result);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫—Ä–∞—Å–∏–≤–æ–º –∞–ª–µ—Ä—Ç–µ
                    const message = `
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–ù–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑–µ: ${result.total_db_books} –∫–Ω–∏–≥
${result.message}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–°–µ–π—á–∞—Å –∑–∞–ø—É—Å—Ç–∏–º –ø–æ–∏—Å–∫ –Ω–æ–≤—ã—Ö –∫–Ω–∏–≥...`;
                    
                    alert(message);
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } else {
                    // –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ
                    const errorData = await response.json();
                    const errorMessage = errorData.detail || errorData.message || `HTTP ${response.status}`;
                    console.error('DEBUG: –û—à–∏–±–∫–∞ search API:', errorMessage);
                    throw new Error(errorMessage);
                }
            } catch (error) {
                console.error('DEBUG: –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º:', error);
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
                searchBtn.disabled = false;
                searchBtn.innerHTML = originalText;
            }
        };
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            console.log('DEBUG: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–µ—Ä—Å–∏–∏
            document.body.setAttribute('data-version', '20260203');
        });
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
