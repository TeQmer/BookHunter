<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Профиль - BookHunter</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/mini-app.css">

    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container" style="display: flex; align-items: center; gap: 12px;">
            <button class="header__back" onclick="window.history.back()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h1 class="header__title" style="font-size: 1.2rem;">
                <i class="fas fa-user"></i> Профиль
            </h1>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav__item" data-route="home">
                <i class="fas fa-home"></i> Главная
            </div>
            <div class="nav__item" data-route="books">
                <i class="fas fa-book"></i> Книги
            </div>
            <div class="nav__item" data-route="alerts">
                <i class="fas fa-bell"></i> Подписки
            </div>
            <div class="nav__item active" data-route="profile">
                <i class="fas fa-user"></i> Профиль
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container" id="main-content">
        <!-- User Info -->
        <div class="profile">
            <div class="profile__avatar">
                <i class="fas fa-user"></i>
            </div>
            <h2 class="profile__name" id="user-name">Загрузка...</h2>
            <p class="profile__username" id="user-username">@username</p>
        </div>

        <!-- Stats -->
        <div class="profile__stats">
            <div class="profile__stat">
                <div class="profile__stat-value" id="stat-alerts">0</div>
                <div class="profile__stat-label">Подписок</div>
            </div>
            <div class="profile__stat">
                <div class="profile__stat-value" id="stat-notifications">0</div>
                <div class="profile__stat-label">Уведомлений</div>
            </div>
            <div class="profile__stat">
                <div class="profile__stat-value" id="stat-books">0</div>
                <div class="profile__stat-label">Найдено</div>
            </div>
        </div>

        <!-- Settings -->
        <h3 style="font-family: 'Georgia', serif; color: var(--accent-primary); margin: 24px 0 16px; font-size: 1.2rem;">
            <i class="fas fa-cog"></i> Настройки
        </h3>

        <div class="card">
            <h4 class="card__header"><i class="fas fa-bell"></i> Уведомления</h4>

            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--bg-accent);">
                <div>
                    <div style="font-weight: 600;">Push уведомления</div>
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">Получать уведомления о скидках</div>
                </div>
                <label class="switch">
                    <input type="checkbox" checked disabled>
                    <span class="slider round"></span>
                </label>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--bg-accent);">
                <div>
                    <div style="font-weight: 600;">Минимальная скидка</div>
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">Уведомлять от X% скидки</div>
                </div>
                <span style="color: var(--text-muted);">10% <i class="fas fa-chevron-right"></i></span>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0;">
                <div>
                    <div style="font-weight: 600;">Максимальная цена</div>
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">Уведомлять до X рублей</div>
                </div>
                <span style="color: var(--text-muted);">1000 ₽ <i class="fas fa-chevron-right"></i></span>
            </div>
        </div>

        <!-- Account -->
        <h3 style="font-family: 'Georgia', serif; color: var(--accent-primary); margin: 24px 0 16px; font-size: 1.2rem;">
            <i class="fas fa-user-cog"></i> Аккаунт
        </h3>

        <div class="card">
            <div style="padding: 12px 0; border-bottom: 1px solid var(--bg-accent); cursor: pointer; opacity: 0.6;">
                <div style="font-weight: 600;"><i class="fas fa-edit"></i> Редактировать профиль</div>
                <div style="font-size: 0.85rem; color: var(--text-muted);">Скоро...</div>
            </div>

            <div style="padding: 12px 0; border-bottom: 1px solid var(--bg-accent); cursor: pointer; opacity: 0.6;">
                <div style="font-weight: 600;"><i class="fas fa-history"></i> История уведомлений</div>
                <div style="font-size: 0.85rem; color: var(--text-muted);">Скоро...</div>
            </div>

            <div style="padding: 12px 0; border-bottom: 1px solid var(--bg-accent); cursor: pointer; opacity: 0.6;">
                <div style="font-weight: 600;"><i class="fas fa-star"></i> Избранное</div>
                <div style="font-size: 0.85rem; color: var(--text-muted);">Скоро...</div>
            </div>

            <div style="padding: 12px 0; cursor: pointer; opacity: 0.6;">
                <div style="font-weight: 600;"><i class="fas fa-trash-alt"></i> Удалить аккаунт</div>
                <div style="font-size: 0.85rem; color: var(--text-muted);">Скоро...</div>
            </div>
        </div>

        <!-- Info -->
        <h3 style="font-family: 'Georgia', serif; color: var(--accent-primary); margin: 24px 0 16px; font-size: 1.2rem;">
            <i class="fas fa-info-circle"></i> Информация
        </h3>

        <div class="card">
            <div style="padding: 12px 0; border-bottom: 1px solid var(--bg-accent);">
                <div style="font-weight: 600;">Версия приложения</div>
                <div style="font-size: 0.85rem; color: var(--text-muted);">1.0.0</div>
            </div>

            <div style="padding: 12px 0; border-bottom: 1px solid var(--bg-accent);">
                <div style="font-weight: 600;">Telegram Web App</div>
                <div style="font-size: 0.85rem; color: var(--text-muted);" id="tg-version">Загрузка...</div>
            </div>

            <div style="padding: 12px 0;">
                <div style="font-weight: 600;">Поддержка</div>
                <div style="font-size: 0.85rem; color: var(--text-muted);">
                    Напишите нам: <a href="https://t.me/your_bot" style="color: var(--accent-primary);">@your_bot</a>
                </div>
            </div>
        </div>

        <!-- Logout -->
        <div class="card" style="text-align: center;">
            <button class="btn btn--danger" onclick="app.logout()" style="opacity: 0.6; cursor: not-allowed;" disabled>
                <i class="fas fa-sign-out-alt"></i> Выйти
            </button>
        </div>
    </main>

    <!-- Footer Space -->
    <div class="footer-space"></div>

    <!-- Scripts -->
    <script src="js/telegram.js"></script>
    <script src="js/mini-app.js"></script>

    <!-- Custom Styles for Switch -->
    <style>
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-accent);
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--accent-primary);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
    </style>

    <script>
        // Расширение приложения для страницы профиля
        BookHunterApp.prototype.logout = function() {
            // TODO: Реализовать выход
            this.showToast('Функция выхода в разработке', 'info');
        };

        // Загрузка данных пользователя при инициализации
        document.addEventListener('DOMContentLoaded', () => {
            const user = window.tg.getUser();

            if (user) {
                // Имя пользователя
                const firstName = user.first_name || '';
                const lastName = user.last_name || '';
                const fullName = `${firstName} ${lastName}`.trim() || 'Пользователь';

                document.getElementById('user-name').textContent = fullName;
                document.getElementById('user-username').textContent = user.username ? `@${user.username}` : 'Нет username';
            }

            // Версия Telegram
            document.getElementById('tg-version').textContent = window.tg.getVersion();

            // Загрузка статистики пользователя
            loadUserStats();
        });

        async function loadUserStats() {
            try {
                const chatId = window.tg.getChatId();

                // Загружаем подписки
                const alertsResponse = await fetch(`${window.app.apiBaseUrl}/api/alerts?user_id=${chatId}`);
                if (alertsResponse.ok) {
                    const alertsData = await alertsResponse.json();
                    const alerts = alertsData.alerts || [];

                    const totalAlerts = alerts.length;
                    const sentNotifications = alerts.reduce((sum, a) => sum + (a.notifications_sent || 0), 0);

                    document.getElementById('stat-alerts').textContent = totalAlerts;
                    document.getElementById('stat-notifications').textContent = sentNotifications;
                }

                // Загружаем общую статистику
                const statsResponse = await fetch(`${window.app.apiBaseUrl}/api/stats/main`);
                if (statsResponse.ok) {
                    const statsData = await statsResponse.json();
                    document.getElementById('stat-books').textContent = statsData.total_books || 0;
                }
            } catch (error) {
                console.error('Ошибка загрузки статистики:', error);
            }
        }
    </script>
</body>
</html>
